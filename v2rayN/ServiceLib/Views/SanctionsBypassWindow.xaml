<Window x:Class="ServiceLib.Views.SanctionsBypassWindow"
        xmlns="http://schemas.microsoft.com/winfx/2006/xaml/presentation"
        xmlns:x="http://schemas.microsoft.com/winfx/2006/xaml"
        xmlns:d="http://schemas.microsoft.com/expression/blend/2008"
        xmlns:mc="http://schemas.openxmlformats.org/markup-compatibility/2006"
        xmlns:local="clr-namespace:ServiceLib.Views"
        mc:Ignorable="d"
        Title="Sanctions Bypass Settings" Height="600" Width="800"
        WindowStartupLocation="CenterScreen"
        Background="{DynamicResource PrimaryBrush}"
        Foreground="{DynamicResource PrimaryTextBrush}">

    <Grid Margin="10">
        <Grid.RowDefinitions>
            <RowDefinition Height="Auto"/>
            <RowDefinition Height="*"/>
            <RowDefinition Height="Auto"/>
        </Grid.RowDefinitions>

        <!-- Header -->
        <StackPanel Grid.Row="0" Margin="0,0,0,20">
            <TextBlock Text="Sanctions Bypass Configuration"
                       FontSize="18" FontWeight="Bold"
                       Margin="0,0,0,10"/>
            <TextBlock Text="Configure automatic DNS switching for Iranian sanctions bypass"
                       FontSize="12" Opacity="0.7"/>
        </StackPanel>

        <!-- Main Content -->
        <ScrollViewer Grid.Row="1" VerticalScrollBarVisibility="Auto">
            <StackPanel Margin="0,0,0,10">

                <!-- Status Section -->
                <GroupBox Header="Current Status" Margin="0,0,0,15">
                    <StackPanel Margin="10">
                        <Grid>
                            <Grid.ColumnDefinitions>
                                <ColumnDefinition Width="Auto"/>
                                <ColumnDefinition Width="*"/>
                                <ColumnDefinition Width="Auto"/>
                            </Grid.ColumnDefinitions>

                            <TextBlock Grid.Column="0" Text="Sanctions Status:"
                                       VerticalAlignment="Center" Margin="0,0,10,0"/>
                            <TextBlock x:Name="txtSanctionsStatus" Grid.Column="1"
                                       Text="Checking..." VerticalAlignment="Center"/>
                            <Button x:Name="btnCheckStatus" Grid.Column="2"
                                    Content="Check Now" Padding="10,5"
                                    Click="btnCheckStatus_Click"/>
                        </Grid>

                        <Grid Margin="0,10,0,0">
                            <Grid.ColumnDefinitions>
                                <ColumnDefinition Width="Auto"/>
                                <ColumnDefinition Width="*"/>
                            </Grid.ColumnDefinitions>

                            <TextBlock Grid.Column="0" Text="Current DNS:"
                                       VerticalAlignment="Center" Margin="0,0,10,0"/>
                            <TextBlock x:Name="txtCurrentDns" Grid.Column="1"
                                       Text="Not configured" VerticalAlignment="Center"/>
                        </Grid>

                        <CheckBox x:Name="chkEnableAutoSwitch" Content="Enable automatic DNS switching"
                                  Margin="0,10,0,0" IsChecked="True"/>
                    </StackPanel>
                </GroupBox>

                <!-- Iranian DNS Servers -->
                <GroupBox Header="Iranian DNS Servers" Margin="0,0,0,15">
                    <StackPanel Margin="10">
                        <TextBlock Text="Configure Iranian DNS servers for sanctions bypass:"
                                   Margin="0,0,0,10" FontWeight="SemiBold"/>

                        <DataGrid x:Name="dgIranianDns" AutoGenerateColumns="False"
                                  Height="200" Margin="0,0,0,10"
                                  CanUserAddRows="False" CanUserDeleteRows="False">
                            <DataGrid.Columns>
                                <DataGridTextColumn Header="Name" Binding="{Binding Key}"
                                                    Width="150" IsReadOnly="True"/>
                                <DataGridTextColumn Header="Primary IP" Binding="{Binding Value}"
                                                    Width="120" IsReadOnly="True"/>
                                <DataGridTemplateColumn Header="Status" Width="80">
                                    <DataGridTemplateColumn.CellTemplate>
                                        <DataTemplate>
                                            <TextBlock Text="Unknown" Foreground="Gray"/>
                                        </DataTemplate>
                                    </DataGridTemplateColumn.CellTemplate>
                                </DataGridTemplateColumn>
                                <DataGridTemplateColumn Header="Test" Width="60">
                                    <DataGridTemplateColumn.CellTemplate>
                                        <DataTemplate>
                                            <Button Content="Test" Padding="5,2"
                                                    Click="btnTestDns_Click" Tag="{Binding Key}"/>
                                        </DataTemplate>
                                    </DataGridTemplateColumn.CellTemplate>
                                </DataGridTemplateColumn>
                            </DataGrid.Columns>
                        </DataGrid>

                        <Button x:Name="btnTestAll" Content="Test All DNS Servers"
                                Padding="10,5" HorizontalAlignment="Left"
                                Click="btnTestAllDns_Click"/>
                    </StackPanel>
                </GroupBox>

                <!-- Google Domains -->
                <GroupBox Header="Protected Domains" Margin="0,0,0,15">
                    <StackPanel Margin="10">
                        <TextBlock Text="Domains that require sanctions bypass:"
                                   Margin="0,0,0,10" FontWeight="SemiBold"/>

                        <ListBox x:Name="lstGoogleDomains" Height="120" Margin="0,0,0,10">
                            <ListBox.ItemTemplate>
                                <DataTemplate>
                                    <TextBlock Text="{Binding}" FontFamily="Consolas"/>
                                </DataTemplate>
                            </ListBox.ItemTemplate>
                        </ListBox>

                        <Button x:Name="btnAddDomain" Content="Add Domain"
                                Padding="10,5" HorizontalAlignment="Left"
                                Click="btnAddDomain_Click"/>
                    </StackPanel>
                </GroupBox>

                <!-- Transparent Mirroring -->
                <GroupBox Header="Transparent Mirroring" Margin="0,0,0,15">
                    <StackPanel Margin="10">
                        <TextBlock Text="Automatically redirect repository requests to Iranian mirrors:"
                                   Margin="0,0,0,10" FontWeight="SemiBold"/>

                        <Grid>
                            <Grid.ColumnDefinitions>
                                <ColumnDefinition Width="Auto"/>
                                <ColumnDefinition Width="Auto"/>
                                <ColumnDefinition Width="Auto"/>
                            </Grid.ColumnDefinitions>

                            <CheckBox x:Name="chkEnableMirroring" Content="Enable transparent mirroring"
                                      VerticalAlignment="Center" Margin="0,0,15,0" IsChecked="True"/>
                            <Button x:Name="btnTestMirrors" Grid.Column="1" Content="Test Mirrors"
                                    Padding="10,5" Margin="0,0,10,0" Click="btnTestMirrors_Click"/>
                            <Button x:Name="btnRefreshMappings" Grid.Column="2" Content="Refresh Mappings"
                                    Padding="10,5" Click="btnRefreshMappings_Click"/>
                        </Grid>

                        <DataGrid x:Name="dgMirrorMappings" AutoGenerateColumns="False"
                                  Height="150" Margin="0,10,0,0"
                                  CanUserAddRows="False" CanUserDeleteRows="False">
                            <DataGrid.Columns>
                                <DataGridTextColumn Header="Original Domain" Binding="{Binding Key}"
                                                    Width="200" IsReadOnly="True"/>
                                <DataGridTextColumn Header="Mirror URL" Binding="{Binding Value}"
                                                    Width="250" IsReadOnly="True"/>
                                <DataGridTemplateColumn Header="Status" Width="80">
                                    <DataGridTemplateColumn.CellTemplate>
                                        <DataTemplate>
                                            <TextBlock Text="Unknown" Foreground="Gray"/>
                                        </DataTemplate>
                                    </DataGridTemplateColumn.CellTemplate>
                                </DataGridTemplateColumn>
                            </DataGrid.Columns>
                        </DataGrid>

                        <Button x:Name="btnAddCustomMapping" Content="Add Custom Mapping"
                                Padding="10,5" HorizontalAlignment="Left" Margin="0,10,0,0"
                                Click="btnAddCustomMapping_Click"/>
                    </StackPanel>
                </GroupBox>

                <!-- Settings -->
                <GroupBox Header="Advanced Settings" Margin="0,0,0,15">
                    <StackPanel Margin="10">
                        <Grid>
                            <Grid.ColumnDefinitions>
                                <ColumnDefinition Width="Auto"/>
                                <ColumnDefinition Width="100"/>
                            </Grid.ColumnDefinitions>

                            <TextBlock Grid.Column="0" Text="Check Interval (minutes):"
                                       VerticalAlignment="Center" Margin="0,0,10,5"/>
                            <TextBox x:Name="txtCheckInterval" Grid.Column="1"
                                     Text="5" VerticalAlignment="Center"/>
                        </Grid>

                        <Grid Margin="0,10,0,0">
                            <Grid.ColumnDefinitions>
                                <ColumnDefinition Width="Auto"/>
                                <ColumnDefinition Width="100"/>
                            </Grid.ColumnDefinitions>

                            <TextBlock Grid.Column="0" Text="Timeout (seconds):"
                                       VerticalAlignment="Center" Margin="0,0,10,5"/>
                            <TextBox x:Name="txtTimeout" Grid.Column="1"
                                     Text="10" VerticalAlignment="Center"/>
                        </Grid>

                        <CheckBox x:Name="chkAutoStart" Content="Start monitoring on application start"
                                  Margin="0,10,0,0" IsChecked="True"/>
                        <CheckBox x:Name="chkEnableTransparentMirroring" Content="Enable transparent mirroring on startup"
                                  Margin="0,10,0,0" IsChecked="True"/>
                    </StackPanel>
                </GroupBox>

                <!-- Logs -->
                <GroupBox Header="Activity Log" Margin="0,0,0,15">
                    <TextBox x:Name="txtLog" Height="150" IsReadOnly="True"
                             VerticalScrollBarVisibility="Auto"
                             FontFamily="Consolas" FontSize="11"/>
                </GroupBox>

            </StackPanel>
        </ScrollViewer>

        <!-- Footer -->
        <StackPanel Grid.Row="2" Orientation="Horizontal" HorizontalAlignment="Right" Margin="0,10,0,0">
            <Button x:Name="btnSave" Content="Save Settings" Padding="15,8" Margin="0,0,10,0"
                    Click="btnSave_Click"/>
            <Button x:Name="btnCancel" Content="Cancel" Padding="15,8"
                    Click="btnCancel_Click"/>
        </StackPanel>
    </Grid>
</Window>
